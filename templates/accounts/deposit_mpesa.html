{% extends "base.html" %}
{% load payments_extras %}
{% block title %}Submit M-Pesa Payment{% endblock %}
{% block content %}
  <div class="max-w-3xl mx-auto">
    <!-- Payment Instructions -->
    <div class="dark-glass rounded-2xl p-8 border border-purple-500/30 mb-6">
      <h2 class="text-3xl font-bold gradient-text mb-2">Send Payment via M-Pesa</h2>
      <p class="text-gray-400 mb-6">Send money to the number below, then submit your confirmation message for verification</p>

      <!-- Payment Options -->
      <div class="mb-8">
        <h3 class="text-lg font-bold text-white mb-4">ğŸ’³ Available Payment Methods</h3>
        {% get_payment_options_for_request as payment_html %}
        {{ payment_html|safe }}
      </div>
    </div>

    <!-- Verification Form -->
    <div class="dark-glass rounded-2xl p-8 border border-purple-500/30">
      <h3 class="text-2xl font-bold gradient-text mb-2">Submit Confirmation Message</h3>
      <p class="text-gray-400 mb-6">After sending money, paste your M-Pesa confirmation SMS below</p>
      
      <form method="post" class="space-y-4">
        {% csrf_token %}
        <div>
          <label class="block text-sm font-medium text-gray-300 mb-2">Amount (USD)</label>
          <div class="relative">
            <span class="absolute left-4 top-3 text-gray-400 text-lg">$</span>
            <input name="amount" type="number" step="0.01" required class="w-full pl-8 pr-4 py-3 bg-slate-800/50 border border-purple-500/30 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-purple-500 transition" id="amount-input" />
          </div>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-300 mb-2">Country</label>
          <select name="country" class="w-full px-4 py-3 bg-slate-800/50 border border-purple-500/30 rounded-lg text-white focus:outline-none focus:border-purple-500 transition">
            <option value="KE">ğŸ‡°ğŸ‡ª Kenya</option>
            <option value="TZ">ğŸ‡¹ğŸ‡¿ Tanzania</option>
            <option value="UG">ğŸ‡ºğŸ‡¬ Uganda</option>
          </select>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-300 mb-2">Phone Number Used</label>
          <input name="phone" type="text" placeholder="e.g. 0712345678" class="w-full px-4 py-3 bg-slate-800/50 border border-purple-500/30 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-purple-500 transition" />
          <p class="text-xs text-gray-400 mt-1">The phone number you used to send money</p>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-300 mb-2">M-Pesa Confirmation Message</label>
          <textarea name="message" rows="6" required class="w-full px-4 py-3 bg-slate-800/50 border border-purple-500/30 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-purple-500 transition" placeholder="Paste your full M-Pesa SMS here. Example:&#10;&#10;RKQ7XYZ123 Confirmed. Ksh5,000.00 sent to 0792167414..."></textarea>
          <p class="text-xs text-gray-400 mt-1">Copy and paste the entire SMS you received after sending money</p>
        </div>

        <button type="submit" class="w-full px-4 py-3 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-500 hover:to-emerald-500 text-white font-bold rounded-lg transition shadow-lg">
          âœ“ Submit for Verification
        </button>
      </form>

      <div class="mt-6 p-4 bg-blue-500/10 border border-blue-500/30 rounded-lg">
        <p class="text-xs text-blue-300">
          <strong>â„¹ï¸ Note:</strong> We'll automatically verify your payment and credit your balance. If automatic verification fails, our team will manually review within 24 hours.
        </p>
      </div>
    </div>
  </div>

  <script>
    // Pre-fill amount from URL parameter
    const urlParams = new URLSearchParams(window.location.search);
    const amount = urlParams.get('amount');
    if (amount) {
      document.getElementById('amount-input').value = amount;
    }
  </script>
{% endblock %}
